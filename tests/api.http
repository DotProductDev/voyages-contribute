### Variables
@baseUrl = http://localhost:7127
@contributionId = contrib-456-new

### Get all contributions (default pagination)
GET {{baseUrl}}/contributions

###

### Get contributions with pagination
GET {{baseUrl}}/contributions?page=2&limit=5

###

### Get contributions sorted by author (ascending)
GET {{baseUrl}}/contributions?sortBy=author&sortOrder=ASC

###

### Get contributions sorted by timestamp (most recent first)
GET {{baseUrl}}/contributions?sortBy=timestamp&sortOrder=DESC

###

### Get contributions with specific status (assuming status enum values 0=pending, 1=approved, 2=rejected)
GET {{baseUrl}}/contributions?status=0

###

### Get contributions with multiple statuses
GET {{baseUrl}}/contributions?status=0&status=1

###

### Get contributions with complex filtering and pagination
GET {{baseUrl}}/contributions?page=1&limit=20&status=1&sortBy=timestamp&sortOrder=DESC

###

### Get single contribution by ID
GET {{baseUrl}}/contributions/{{contributionId}}

###

### Get non-existent contribution (should return 404)
GET {{baseUrl}}/contributions/non-existent-id

###

### Create new contribution
POST {{baseUrl}}/contributions
Content-Type: application/json

{
  "id": "contrib-456-new",
  "root": {
    "entityType": "Article",
    "entityId": "article-789"
  },
  "changeSet": {
    "title": "Update article content",
    "comments": "Fixed typos and added new information",
    "changes": [
      {
        "operation": "update",
        "path": "/content/title",
        "oldValue": "Old Title",
        "newValue": "New Updated Title"
      },
      {
        "operation": "update",
        "path": "/content/body",
        "oldValue": "Old content with typos",
        "newValue": "New content with corrections"
      }
    ]
  },
  "status": 0,
  "reviews": [],
  "media": []
}

###

### Create another contribution
POST {{baseUrl}}/contributions
Content-Type: application/json

{
  "id": "contrib-101-audio",
  "root": {
    "entityType": "Tutorial",
    "entityId": "tutorial-202"
  },
  "changeSet": {
    "title": "Add pronunciation guide",
    "comments": "Added audio pronunciation for technical terms",
    "changes": [
      {
        "operation": "add",
        "path": "/pronunciation",
        "newValue": "audio-guide.mp3"
      }
    ]
  },
  "status": 0
}

###

### Submit contribution for review
PATCH {{baseUrl}}/contributions/{{contributionId}}/change_status
Content-Type: application/json

{
  "status": 1
}

###

### Add review with specific author and timestamp

POST {{baseUrl}}/contributions/{{contributionId}}/add_review
Content-Type: application/json

{
  "changeSet": {
    "author": "senior.reviewer@example.com",
    "title": "Senior review - needs changes",
    "comments": "The content needs more citations and the conclusion should be strengthened",
    "timestamp": 1704067200000,
    "changes": [
      {
        "operation": "add",
        "path": "/content/citations",
        "newValue": "Add citations for claims in paragraph 3"
      },
      {
        "operation": "update",
        "path": "/content/conclusion",
        "oldValue": "Basic conclusion",
        "newValue": "Strengthened conclusion with better summary"
      }
    ]
  }
}

###

### Add a second review emulating a Bot

POST {{baseUrl}}/contributions/{{contributionId}}/add_review
Content-Type: application/json

{
  "changeSet": {
    "author": "Impute bot",
    "title": "Impute script",
    "comments": "This is an automated review generated by the Impute bot",
    "timestamp": 1704067500000,
    "changes": [
      {
        "imputed_var_abc": "Imputed value for variable ABC",
        "imputed_var_efg": "Imputed value for variable EFG"
      }
    ]
  }
}

###

### Upload media to contribution (image)
POST {{baseUrl}}/contributions/{{contributionId}}/upload_media
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="name"

Recipe Step 1 Image
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="comments"

Shows the initial preparation step
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="step1.jpg"
Content-Type: image/jpeg

< ./test-files/sample.jpeg
------WebKitFormBoundary7MA4YWxkTrZu0gW--

###

### Upload media to contribution (audio)
POST {{baseUrl}}/contributions/{{contributionId}}/upload_media
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="name"

Pronunciation Guide
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="comments"

Audio pronunciation for technical terms
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="pronunciation.mp3"
Content-Type: audio/mpeg

< ./test-files/audio.mp3
------WebKitFormBoundary7MA4YWxkTrZu0gW--

###

### Upload media to contribution (document)
POST {{baseUrl}}/contributions/{{contributionId}}/upload_media
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="name"

Supporting Documentation
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="comments"

Additional reference material
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="reference.pdf"
Content-Type: application/pdf

< ./test-files/reference.pdf
------WebKitFormBoundary7MA4YWxkTrZu0gW--

###

### Error case - no file uploaded
POST {{baseUrl}}/contributions/{{contributionId}}/upload_media
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="name"

Missing File Test
------WebKitFormBoundary7MA4YWxkTrZu0gW--

###

### Error case - missing name field
POST {{baseUrl}}/contributions/{{contributionId}}/upload_media
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="comments"

This upload is missing the name field
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="test.jpg"
Content-Type: image/jpeg

< ./test-files/sample.jpeg
------WebKitFormBoundary7MA4YWxkTrZu0gW--

###

### Error case - upload to non-existent contribution
POST {{baseUrl}}/contributions/non-existent-id/upload_media
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="name"

Non-existent Contribution Test
------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="file"; filename="test.jpg"
Content-Type: image/jpeg

< ./test-files/test.jpg
------WebKitFormBoundary7MA4YWxkTrZu0gW--

###

### Delete media by ID
@mediaId = 1

DELETE {{baseUrl}}/media/{{mediaId}}

###

### Error case - delete non-existent media
DELETE {{baseUrl}}/media/99999

###

### Create publication batch
POST {{baseUrl}}/create_batch
Content-Type: application/json

{
  "title": "Q1 2025 Recipe Collection",
  "comments": "First quarterly batch of new recipes and cooking guides"
}

###

### Create batch with minimal data
POST {{baseUrl}}/create_batch
Content-Type: application/json

{
  "title": "Quick Fixes & Tips"
}

###

### Assign contribution to batch
@batchId = 1

PATCH {{baseUrl}}/assign_to_batch
Content-Type: application/json

{
  "contribution_id": "{{contributionId}}",
  "batch_id": {{batchId}}
}

###

### Prepare sample contributions for multi-assignment (create if not already present)
### These three contributions enable testing the success path of assigning
### multiple IDs in one request. If they already exist, server will replace
### the WorkInProgress version (status 0) with the provided changeSet.
POST {{baseUrl}}/contributions
Content-Type: application/json

{
  "id": "contrib-multi-1",
  "root": {
    "entityType": "Article",
    "entityId": "article-multi-1"
  },
  "changeSet": {
    "title": "Multi Assign Sample 1",
    "comments": "Created for multi-batch assignment test",
    "changes": [
      { "operation": "add", "path": "/field1", "newValue": "value1" }
    ]
  },
  "status": 0
}

###
POST {{baseUrl}}/contributions
Content-Type: application/json

{
  "id": "contrib-multi-2",
  "root": {
    "entityType": "Article",
    "entityId": "article-multi-2"
  },
  "changeSet": {
    "title": "Multi Assign Sample 2",
    "comments": "Created for multi-batch assignment test",
    "changes": [
      { "operation": "add", "path": "/field2", "newValue": "value2" }
    ]
  },
  "status": 0
}

###
POST {{baseUrl}}/contributions
Content-Type: application/json

{
  "id": "contrib-multi-3",
  "root": {
    "entityType": "Article",
    "entityId": "article-multi-3"
  },
  "changeSet": {
    "title": "Multi Assign Sample 3",
    "comments": "Created for multi-batch assignment test",
    "changes": [
      { "operation": "add", "path": "/field3", "newValue": "value3" }
    ]
  },
  "status": 0
}

###

### Assign multiple contributions to batch (array form)
@multiContributionA = contrib-multi-1
@multiContributionB = contrib-multi-2
@multiContributionC = contrib-multi-3

PATCH {{baseUrl}}/assign_to_batch
Content-Type: application/json

{
  "contribution_id": [
    "{{multiContributionA}}",
    "{{multiContributionB}}",
    "{{multiContributionC}}"
  ],
  "batch_id": {{batchId}}
}

###

### Clear multiple contributions from batch (set to null)
PATCH {{baseUrl}}/assign_to_batch
Content-Type: application/json

{
  "contribution_id": [
    "{{multiContributionA}}",
    "{{multiContributionB}}",
    "{{multiContributionC}}"
  ],
  "batch_id": null
}

###

### Advanced queries - Get contributions associated to batch

GET {{baseUrl}}/contributions?batch_id=1

###


### Advanced queries - Get contributions associated not associated to any batch

GET {{baseUrl}}/contributions?status=0&batch_id=null

###


### Clear contribution batch assignment (set to null)
PATCH {{baseUrl}}/assign_to_batch
Content-Type: application/json

{
  "contribution_id": "{{contributionId}}",
  "batch_id": null
}

###

### Assign different contribution to same batch
@secondContributionId = contrib_456

PATCH {{baseUrl}}/assign_to_batch
Content-Type: application/json

{
  "contribution_id": "{{secondContributionId}}",
  "batch_id": {{batchId}}
}

###

### Error case - create batch without title
POST {{baseUrl}}/create_batch
Content-Type: application/json

{
  "comments": "Missing title should fail"
}

###

### Error case - assign to non-existent batch
PATCH {{baseUrl}}/assign_to_batch
Content-Type: application/json

{
  "contribution_id": "{{contributionId}}",
  "batch_id": 99999
}

###

### Error case - assign non-existent contribution
PATCH {{baseUrl}}/assign_to_batch
Content-Type: application/json

{
  "contribution_id": "non-existent-id",
  "batch_id": {{batchId}}
}

###

### Error case - one of multiple contributions does not exist
PATCH {{baseUrl}}/assign_to_batch
Content-Type: application/json

{
  "contribution_id": [
    "{{multiContributionA}}",
    "non-existent-id",
    "{{multiContributionC}}"
  ],
  "batch_id": {{batchId}}
}

###

### Error case - missing contribution_id
PATCH {{baseUrl}}/assign_to_batch
Content-Type: application/json

{
  "batch_id": {{batchId}}
}

###

### Get all batches
GET {{baseUrl}}/batches/all

###

### Get published batches only
GET {{baseUrl}}/batches/published

###

### Get pending batches only
GET {{baseUrl}}/batches/pending

###

### Delete batch (will only succeed if it has no contributions)
DELETE {{baseUrl}}/batches/{{batchId}}

###

### Error case - delete batch that still has contributions (recreate / reassign first if needed)
DELETE {{baseUrl}}/batches/1

###


### Delete contribution
# DELETE {{baseUrl}}/contributions/{{contributionId}}

###

### Delete non-existent contribution (should return 404)
# DELETE {{baseUrl}}/contributions/non-existent-id

###

### Advanced queries - Get pending contributions sorted by author
GET {{baseUrl}}/contributions?status=0&sortBy=author&sortOrder=ASC&page=1&limit=10

###

### Get approved and rejected contributions with pagination
GET {{baseUrl}}/contributions?status=1&status=2&page=2&limit=15

###

### Get contributions sorted by newest first with large page size
GET {{baseUrl}}/contributions?sortBy=timestamp&sortOrder=DESC&page=1&limit=50

###

### Edge case - very high page number (should return empty results)
GET {{baseUrl}}/contributions?page=9999&limit=10

###

### Edge case - zero limit (should use default)
GET {{baseUrl}}/contributions?page=1&limit=0

###

### Publish a batch
POST {{baseUrl}}/publish
Content-Type: application/json

{
  "mode": "batch",
  "id": 1
}

###